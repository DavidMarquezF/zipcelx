"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var escape=_interopDefault(require("lodash.escape")),FileSaver=_interopDefault(require("file-saver")),JSZip=_interopDefault(require("jszip"));const CELL_TYPE_STRING="string",CELL_TYPE_NUMBER="number",CELL_TYPE_DATE="date",CELL_TYPE_TIME="time",CELL_TYPE_DATETIME="datetime",validTypes=["string","number","date","time","datetime"],MISSING_KEY_FILENAME="Zipclex config missing property filename",INVALID_TYPE_FILENAME="Zipclex filename can only be of type string",INVALID_TYPE_SHEET="Zipcelx sheet data is not of type array",INVALID_TYPE_SHEET_DATA="Zipclex sheet data childs is not of type array",WARNING_INVALID_TYPE='Invalid type supplied in cell config, falling back to "string"',generateColumnLetter=e=>{if("number"!=typeof e)return"";const t=Math.floor(e/26),o=String.fromCharCode(97+e%26).toUpperCase();return 0===t?o:generateColumnLetter(t-1)+o};var generatorCellNumber=(e,t)=>`${generateColumnLetter(e)}${t}`,generatorStringCell=(e,t,o)=>`<c r="${generatorCellNumber(e,o)}" t="inlineStr"><is><t>${escape(t)}</t></is></c>`,generatorNumberCell=(e,t,o)=>`<c r="${generatorCellNumber(e,o)}"><v>${t}</v></c>`;const MS_PER_DAY=864e5,START_DATE=new Date(1900,0,0);function getDate(e){const t=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate());return Math.round((t-START_DATE)/MS_PER_DAY)+1}var generatorDateCell=(e,t,o,r)=>`<c r="${generatorCellNumber(e,o)}" s="${r}"><v>${1===r?getDate(t):t}</v></c>`,formatCell=(e,t,o)=>{switch(-1===validTypes.indexOf(e.type)&&(console.warn(WARNING_INVALID_TYPE),e.type="string"),e.type){case"string":return generatorStringCell(t,e.value,o);case"number":return generatorNumberCell(t,e.value,o);case"date":return generatorDateCell(t,e.value,o,1);case"time":return generatorDateCell(t,e.value,o,2);case"datetime":return generatorDateCell(t,e.value,o,3);default:return generatorStringCell(t,e.value,o)}},formatRow=(e,t)=>{const o=t+1,r=e.map((e,t)=>formatCell(e,t,o)).join("");return`<row r="${o}">${r}</row>`},generatorRows=e=>e.map((e,t)=>formatRow(e,t)).join(""),rels='<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships"><Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument" Target="xl/workbook.xml"/></Relationships>',stylesXML='<?xml version="1.0" encoding="utf-8"?><styleSheet xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main">\n<fonts count="1"><font><sz val="11"/><name val="Calibri"/><family val="2"/></font></fonts><fills count="2"><fill><patternFill patternType="none"/></fill><fill><patternFill patternType="gray125"/></fill></fills><borders count="1"><border diagonalDown="0" diagonalUp="0"><left/><right/><top/><bottom/><diagonal/></border></borders><cellStyleXfs count="1"><xf numFmtId="0" fontId="0" fillId="0" borderId="0" /></cellStyleXfs><cellXfs count="2"><xf numFmtId="0" fontId="0" fillId="0" borderId="0" xfId="0" applyNumberFormat="1" /><xf numFmtId="14" fontId="0" fillId="0" borderId="0" xfId="0" applyNumberFormat="1" /></cellXfs><cellStyles count="1"><cellStyle xfId="0" builtinId="0" name="Normal"/></cellStyles></styleSheet>',workbookXML='<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n<workbook xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships" xmlns:mx="http://schemas.microsoft.com/office/mac/excel/2008/main" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:mv="urn:schemas-microsoft-com:mac:vml" xmlns:x14="http://schemas.microsoft.com/office/spreadsheetml/2009/9/main" xmlns:x14ac="http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac" xmlns:xm="http://schemas.microsoft.com/office/excel/2006/main"><workbookPr/><sheets><sheet state="visible" name="Sheet1" sheetId="1" r:id="rId3"/></sheets><definedNames/><calcPr/></workbook>',workbookXMLRels='<?xml version="1.0" ?>\n<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">\n<Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles" Target="styles.xml"/>\n<Relationship Id="rId3" Target="worksheets/sheet1.xml" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet"/>\n</Relationships>',contentTypes='<?xml version="1.0" ?>\n<Types xmlns="http://schemas.openxmlformats.org/package/2006/content-types">\n<Default ContentType="application/xml" Extension="xml"/>\n<Default ContentType="application/vnd.openxmlformats-package.relationships+xml" Extension="rels"/>\n<Override ContentType="application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml" PartName="/xl/worksheets/sheet1.xml"/>\n<Override ContentType="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml" PartName="/xl/workbook.xml"/>\n</Types>',templateSheet='<?xml version="1.0" ?>\n<worksheet xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:mv="urn:schemas-microsoft-com:mac:vml" xmlns:mx="http://schemas.microsoft.com/office/mac/excel/2008/main" xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships" xmlns:x14="http://schemas.microsoft.com/office/spreadsheetml/2009/9/main" xmlns:x14ac="http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac" xmlns:xm="http://schemas.microsoft.com/office/excel/2006/main"><sheetData>{placeholder}</sheetData></worksheet>';const childValidator=e=>e.every(e=>Array.isArray(e));var validator=e=>e.filename?"string"!=typeof e.filename?(console.error(INVALID_TYPE_FILENAME),!1):Array.isArray(e.sheet.data)?!!childValidator(e.sheet.data)||(console.error(INVALID_TYPE_SHEET_DATA),!1):(console.error(INVALID_TYPE_SHEET),!1):(console.error(MISSING_KEY_FILENAME),!1);const generateXMLWorksheet=e=>{const t=generatorRows(e);return templateSheet.replace("{placeholder}",t)};var zipcelx=e=>{if(!validator(e))throw new Error("Validation failed.");const t=new JSZip,o=t.folder("xl");o.file("workbook.xml",workbookXML),o.file("_rels/workbook.xml.rels",workbookXMLRels),o.file("styles.xml",stylesXML),t.file("_rels/.rels",rels),t.file("[Content_Types].xml",contentTypes);const r=generateXMLWorksheet(e.sheet.data);return o.file("worksheets/sheet1.xml",r),t.generateAsync({type:"blob",mimeType:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}).then(t=>{FileSaver.saveAs(t,`${e.filename}.xlsx`)})};exports.generateXMLWorksheet=generateXMLWorksheet,exports.default=zipcelx;
